(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/publish/publish"],{"1a9f":function(e,t,i){"use strict";var n=i("db56"),o=i.n(n);o.a},"23ed":function(e,t,i){"use strict";(function(e,t){var n=i("47a9");i("2864");n(i("3240"));var o=n(i("f83a"));e.__webpack_require_UNI_MP_PLUGIN__=i,t(o.default)}).call(this,i("3223")["default"],i("df3c")["createPage"])},"5b85":function(e,t,i){"use strict";i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return o})),i.d(t,"a",(function(){}));var n=function(){var e=this.$createElement;this._self._c},o=[]},ad0f:function(e,t,i){"use strict";i.r(t);var n=i("ae2a"),o=i.n(n);for(var r in n)["default"].indexOf(r)<0&&function(e){i.d(t,e,(function(){return n[e]}))}(r);t["default"]=o.a},ae2a:function(e,t,i){"use strict";(function(e){var n=i("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=n(i("7eb4")),r=n(i("7ca3")),a=n(i("ee10")),c=n(i("af34")),s=i("6213"),u=n(i("578c")),d=i("871e");function l(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function f(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?l(Object(i),!0).forEach((function(t){(0,r.default)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):l(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var h={data:function(){return{pageData:[],showEditPopup:!1,currentItem:{},categories:[],pickerRange:[],selectedCategoryIndex:0,imageUploaded:!1,showEditPopup1:!1,pickerRange1:[],selectedCategoryIndex1:0,itemDescription:"",itemPrice:"",marketList:[]}},mixins:[u.default],onShow:function(){this.reloadData()},methods:{fetchCategories:function(){var e=this;s.api.cglist().then((function(t){if(200===t.code){var i=t.data.listdata.map((function(e){return{id:e.id,content:e.content}}));e.categories=i,e.pickerRange=(0,c.default)(i.map((function(e){return e.content})))}}))},fetchMarketList:function(){var t=this;return(0,a.default)(o.default.mark((function i(){var n,r,a;return o.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.prev=0,e.getStorageSync("token"),n={limit:100,page:1},i.next=5,s.api.getMyShops(f({token:t.token},n));case 5:r=i.sent,200===r.code?(a=r.data.listdata.map((function(e){return{id:e.id,title:e.title}})),t.marketList=a,t.pickerRange1=(0,c.default)(a.map((function(e){return e.title})))):console.error("Failed to fetch market list:",r.msg),i.next=12;break;case 9:i.prev=9,i.t0=i["catch"](0),console.error("Error fetching market list:",i.t0);case 12:case"end":return i.stop()}}),i,null,[[0,9]])})))()},onCategoryChange:function(e){this.selectedCategoryIndex=e.detail.value,this.currentItem.category_id=this.categories[this.selectedCategoryIndex].id},onMarketChange:function(e){this.selectedCategoryIndex1=e.detail.value,this.currentItem.market_id=this.marketList[this.selectedCategoryIndex1].id},fetchData:function(e){return(0,a.default)(o.default.mark((function t(){var i;return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,s.api.getCommdityList(e);case 2:return i=t.sent,t.abrupt("return",i.data);case 4:case"end":return t.stop()}}),t)})))()},goTorelePage:function(){e.navigateTo({url:"/pages/release/release"})},edit:function(e){this.currentItem=f({},e),this.fetchCategories(),this.showEditPopup=!0,this.fetchCommodityDetails(e.id)},fetchCommodityDetails:function(e){var t=this;s.api.getCommodityDetails(e).then((function(e){if(200===e.code){var i=e.data.listdata[0];t.currentItem.goodsname=i.goodsname,t.currentItem.imglogo=i.imglogo;var n=t.categories.findIndex((function(e){return e.id===i.category_id}));-1!==n&&(t.selectedCategoryIndex=n)}}))},uploadcuisine:function(){var t=this;e.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(e){var i=e.tempFilePaths;if(i.length>0){var n=(0,d.useUpload)({uploadPath:"/group1/upload",tempFilePaths:i[0]}),o=n.upload;n.request;o().then((function(e){console.log(e),t.currentItem.imglogo=e,console.log("更新后的图片路径:",t.currentItem.imglogo),t.isImageSelected=!0,t.imageUploaded=!0}))}}})},shelves:function(e){this.currentItem=f({},e),this.showEditPopup1=!0,this.fetchMarketList()},closePopup:function(){this.showEditPopup=!1,this.showEditPopup1=!1},confirmEdit:function(){var t=this;if(this.currentItem.id)if(this.imageUploaded||this.currentItem.imglogo){var i=this.currentItem,n=i.id,o=i.category_id,r=i.goodsname,a=i.imglogo;s.api.editGoods({id:n,category_id:o,goodsname:r,imglogo:a}).then((function(i){200===i.code?(e.showToast({title:"商品修改成功",icon:"success"}),t.reloadData(),t.closePopup()):e.showToast({title:i.msg||"商品修改失败",icon:"none"})}))}else e.showToast({title:"请上传图片",icon:"none"});else e.showToast({title:"商品 ID 不正确",icon:"none"})},confirmShelves:function(){var t=this;console.log("Goods ID:",this.currentItem.id),this.itemPrice?s.api.addCommodityToShop({goods_id:this.currentItem.id,shop_id:this.marketList[this.selectedCategoryIndex1].id,content:this.itemDescription,price:parseFloat(this.itemPrice)}).then((function(i){200===i.code?(e.showToast({title:"上架成功"}),t.closePopup(),t.reloadData()):e.showToast({title:"上架失败",icon:"none"})})):e.showToast({title:"请填写价格",icon:"none"})}}};t.default=h}).call(this,i("df3c")["default"])},db56:function(e,t,i){},f83a:function(e,t,i){"use strict";i.r(t);var n=i("5b85"),o=i("ad0f");for(var r in o)["default"].indexOf(r)<0&&function(e){i.d(t,e,(function(){return o[e]}))}(r);i("1a9f");var a=i("828b"),c=Object(a["a"])(o["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],void 0);t["default"]=c.exports}},[["23ed","common/runtime","common/vendor"]]]);